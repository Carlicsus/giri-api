ext.loadEnv = {
    def file = new File(".env")
    if (file.exists()) {
        file.eachLine { line ->
            if (line && !line.startsWith("#") && line.contains("=")) {
                def (key, value) = line.split("=", 2)
                System.setProperty(key.trim(), value.trim())
            }
        }
    }
}

tasks.withType(JavaExec) {
    doFirst {
        loadEnv()
        System.properties.each { k, v ->
            systemProperty k, v
        }
    }
}

tasks.withType(Test) {
    systemProperty "geb.env", System.getProperty('geb.env')
    systemProperty "geb.build.reportsDir", reporting.file("geb/integrationTest")
    systemProperty "webdriver.chrome.driver", System.getProperty('webdriver.chrome.driver')
    systemProperty "webdriver.gecko.driver", System.getProperty('webdriver.gecko.driver')
    doFirst {
        loadEnv()
        System.properties.each { k, v ->
            systemProperty k, v
        }
    }
}
